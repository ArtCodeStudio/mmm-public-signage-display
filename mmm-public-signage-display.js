!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2);class i extends n.EventEmitter{constructor(e,t,r){if(super(),this.magicMirrorHelper=e,this.magicMirrorLogger=t,this.magicMirrorModule=r,this.socketModule=io("/mmm-public-signage-display"),this.magicMirrorLogger.log("SocketService constructor",r),i.instance)return i.instance;i.instance=this}initNotificationForwarding(){this.socketModule.on("*",(e,t)=>{this.magicMirrorLogger.log(`[${this.magicMirrorModule.name}] * notification`,e,t),this.magicMirrorHelper.sendNotification(e,t,this.magicMirrorModule),this.emit(e,t,this.magicMirrorModule)})}}t.SocketService=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(3);let o=null,s=null;Module.register("mmm-public-signage-display",{defaults:{},start(){Log.log(`[${this.name}] started`,MM,this),o=new n.SocketService(MM,Log,this),s=new i.ModulesService(MM,Log,this),o.initNotificationForwarding()},getTemplate(){return Log.log(`[${this.name}] getTemplate`),""},notificationReceived(e,t,r){Log.log(`[${this.name}] notificationReceived ${e} from sender ${r}`,t)},socketNotificationReceived(e,t){Log.log(`[${this.name}] socketNotificationReceived ${e}`,t),s&&"SHOW_MODULES"===e&&s.setPositions(t.modules)}})},function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function u(){u.init.call(this)}e.exports=u,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var c=10;function l(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function a(e,t,r,n){var i,o,s,u;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=l(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,u=c,console&&console.warn&&console.warn(u)}return e}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,e))}.bind(n);return i.listener=r,n.wrapFn=i,i}function p(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):d(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function d(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},u.prototype.getMaxListeners=function(){return l(this)},u.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var u=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw u.context=s,u}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var l=c.length,a=d(c,l);for(r=0;r<l;++r)o(a[r],this,t)}return!0},u.prototype.addListener=function(e,t){return a(this,e,t,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(e,t){return a(this,e,t,!0)},u.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,f(this,e,t)),this},u.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,f(this,e,t)),this},u.prototype.removeListener=function(e,t){var r,n,i,o,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},u.prototype.listeners=function(e){return p(this,e,!0)},u.prototype.rawListeners=function(e){return p(this,e,!1)},u.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},u.prototype.listenerCount=h,u.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);class i{constructor(e,t,r){if(this.magicMirrorHelper=e,this.magicMirrorLogger=t,this.magicMirrorModule=r,this.socketService=new n.SocketService(e,t,r),i.instance)return i.instance;i.instance=this,this.socketService.on("SHOW_MODULES",e=>{this.magicMirrorLogger.log("ModulesService",e),this.hideAll(),this.setPositions(e.modules)})}getid(e){let t;return this.magicMirrorHelper.getModules().enumerate(r=>{e===r.name&&(t=r.identifier)}),t}hideAll(){this.magicMirrorHelper.getModules().enumerate(e=>{e.hide()})}setPositions(e){this.magicMirrorLogger.log("setPositions",e);for(const t of e){const e=t.module.module,r=this.getid(e);this.magicMirrorLogger.log("id",r),this.magicMirrorHelper.getModules().withClass(e).enumerate(e=>{if(t.position){const e=t.position.split("_"),n=document.getElementById(r),i=document.querySelector("div.region."+e[0]+"."+e[1]+" div.container");this.magicMirrorLogger.log("setPositions",t.name),"none"===i.style.display&&(i.style.display="block"),i.appendChild(n)}!0===t.visible?e.show():!1===t.visible&&e.hide()})}}setDefaults(){this.magicMirrorHelper.getModules().enumerate(e=>{if(e.data.position){const t=e.data.position.split("_"),r=document.getElementById(e.identifier),n=document.querySelector("div.region."+t[0]+"."+t[1]+" div.container");"none"===n.style.display&&(n.style.display="block"),n.appendChild(r),e.show(1e3,()=>{})}})}}t.ModulesService=i}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NsaWVudC9zb2NrZXQuc2VydmljZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvY2xpZW50LnRzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9ldmVudHMvZXZlbnRzLmpzIiwid2VicGFjazovLy8uL3NyYy9jbGllbnQvbW9kdWxlcy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiZXZlbnRzXzEiLCJTb2NrZXRTZXJ2aWNlIiwiRXZlbnRFbWl0dGVyIiwiW29iamVjdCBPYmplY3RdIiwibWFnaWNNaXJyb3JIZWxwZXIiLCJtYWdpY01pcnJvckxvZ2dlciIsIm1hZ2ljTWlycm9yTW9kdWxlIiwic3VwZXIiLCJ0aGlzIiwic29ja2V0TW9kdWxlIiwiaW8iLCJsb2ciLCJpbnN0YW5jZSIsIm9uIiwibm90aWZpY2F0aW9uIiwiZGF0YSIsInNlbmROb3RpZmljYXRpb24iLCJlbWl0Iiwic29ja2V0X3NlcnZpY2VfMSIsIm1vZHVsZXNfc2VydmljZV8xIiwic29ja2V0U2VydmljZSIsIm1vZHVsZXNTZXJ2aWNlIiwiTW9kdWxlIiwicmVnaXN0ZXIiLCJkZWZhdWx0cyIsIkxvZyIsIk1NIiwiTW9kdWxlc1NlcnZpY2UiLCJpbml0Tm90aWZpY2F0aW9uRm9yd2FyZGluZyIsInBheWxvYWQiLCJzZW5kZXIiLCJzZXRQb3NpdGlvbnMiLCJSZWZsZWN0T3duS2V5cyIsIlIiLCJSZWZsZWN0IiwiUmVmbGVjdEFwcGx5IiwiYXBwbHkiLCJ0YXJnZXQiLCJyZWNlaXZlciIsImFyZ3MiLCJGdW5jdGlvbiIsIm93bktleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJnZXRPd25Qcm9wZXJ0eU5hbWVzIiwiY29uY2F0IiwiTnVtYmVySXNOYU4iLCJOdW1iZXIiLCJpc05hTiIsImluaXQiLCJfZXZlbnRzIiwidW5kZWZpbmVkIiwiX2V2ZW50c0NvdW50IiwiX21heExpc3RlbmVycyIsImRlZmF1bHRNYXhMaXN0ZW5lcnMiLCIkZ2V0TWF4TGlzdGVuZXJzIiwidGhhdCIsIl9hZGRMaXN0ZW5lciIsInR5cGUiLCJsaXN0ZW5lciIsInByZXBlbmQiLCJldmVudHMiLCJleGlzdGluZyIsIndhcm5pbmciLCJUeXBlRXJyb3IiLCJuZXdMaXN0ZW5lciIsInVuc2hpZnQiLCJwdXNoIiwibGVuZ3RoIiwid2FybmVkIiwidyIsIkVycm9yIiwiU3RyaW5nIiwiZW1pdHRlciIsImNvdW50IiwiY29uc29sZSIsIndhcm4iLCJfb25jZVdyYXAiLCJzdGF0ZSIsImZpcmVkIiwid3JhcEZuIiwid3JhcHBlZCIsImFyZ3VtZW50cyIsInJlbW92ZUxpc3RlbmVyIiwiX2xpc3RlbmVycyIsInVud3JhcCIsImV2bGlzdGVuZXIiLCJhcnIiLCJyZXQiLCJBcnJheSIsInVud3JhcExpc3RlbmVycyIsImFycmF5Q2xvbmUiLCJsaXN0ZW5lckNvdW50IiwiY29weSIsInNldCIsImFyZyIsIlJhbmdlRXJyb3IiLCJnZXRQcm90b3R5cGVPZiIsInNldE1heExpc3RlbmVycyIsImdldE1heExpc3RlbmVycyIsImRvRXJyb3IiLCJlcnJvciIsImVyIiwiZXJyIiwibWVzc2FnZSIsImNvbnRleHQiLCJoYW5kbGVyIiwibGVuIiwibGlzdGVuZXJzIiwiYWRkTGlzdGVuZXIiLCJwcmVwZW5kTGlzdGVuZXIiLCJvbmNlIiwicHJlcGVuZE9uY2VMaXN0ZW5lciIsImxpc3QiLCJwb3NpdGlvbiIsIm9yaWdpbmFsTGlzdGVuZXIiLCJzaGlmdCIsImluZGV4IiwicG9wIiwic3BsaWNlT25lIiwib2ZmIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwia2V5cyIsInJhd0xpc3RlbmVycyIsImV2ZW50TmFtZXMiLCJoaWRlQWxsIiwibW5hbWUiLCJpZCIsImdldE1vZHVsZXMiLCJlbnVtZXJhdGUiLCJpZGVudGlmaWVyIiwiaGlkZSIsInRpbWVsaW5lTW9kdWxlcyIsInRpbWVsaW5lTW9kdWxlIiwibW9kdWxlTmFtZSIsImdldGlkIiwid2l0aENsYXNzIiwic3BsaXRQb3NpdGlvbiIsInNwbGl0Iiwic2VsZWN0ZWRNb2R1bGUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwicmVnaW9uIiwicXVlcnlTZWxlY3RvciIsInN0eWxlIiwiZGlzcGxheSIsImFwcGVuZENoaWxkIiwidmlzaWJsZSIsInNob3ciXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxHQUFBLENBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsUUFBQSxJQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVBQUFELFFBQUFDLElBQUFELFFBQUFGLEdBR0FHLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUFLQUYsRUFBQVEsRUFBQUYsRUFHQU4sRUFBQVMsRUFBQVYsRUFHQUMsRUFBQVUsRUFBQSxTQUFBUixFQUFBUyxFQUFBQyxHQUNBWixFQUFBYSxFQUFBWCxFQUFBUyxJQUNBRyxPQUFBQyxlQUFBYixFQUFBUyxFQUFBLENBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFDWixFQUFBa0IsRUFBQSxTQUFBaEIsR0FDQSxvQkFBQWlCLGVBQUFDLGFBQ0FOLE9BQUFDLGVBQUFiLEVBQUFpQixPQUFBQyxZQUFBLENBQXdEQyxNQUFBLFdBRXhEUCxPQUFBQyxlQUFBYixFQUFBLGNBQWlEbUIsT0FBQSxLQVFqRHJCLEVBQUFzQixFQUFBLFNBQUFELEVBQUFFLEdBRUEsR0FEQSxFQUFBQSxJQUFBRixFQUFBckIsRUFBQXFCLElBQ0EsRUFBQUUsRUFBQSxPQUFBRixFQUNBLEtBQUFFLEdBQUEsaUJBQUFGLFFBQUFHLFdBQUEsT0FBQUgsRUFDQSxJQUFBSSxFQUFBWCxPQUFBWSxPQUFBLE1BR0EsR0FGQTFCLEVBQUFrQixFQUFBTyxHQUNBWCxPQUFBQyxlQUFBVSxFQUFBLFdBQXlDVCxZQUFBLEVBQUFLLFVBQ3pDLEVBQUFFLEdBQUEsaUJBQUFGLEVBQUEsUUFBQU0sS0FBQU4sRUFBQXJCLEVBQUFVLEVBQUFlLEVBQUFFLEVBQUEsU0FBQUEsR0FBZ0gsT0FBQU4sRUFBQU0sSUFBcUJDLEtBQUEsS0FBQUQsSUFDckksT0FBQUYsR0FJQXpCLEVBQUE2QixFQUFBLFNBQUExQixHQUNBLElBQUFTLEVBQUFULEtBQUFxQixXQUNBLFdBQTJCLE9BQUFyQixFQUFBLFNBQzNCLFdBQWlDLE9BQUFBLEdBRWpDLE9BREFILEVBQUFVLEVBQUFFLEVBQUEsSUFBQUEsR0FDQUEsR0FJQVosRUFBQWEsRUFBQSxTQUFBaUIsRUFBQUMsR0FBc0QsT0FBQWpCLE9BQUFrQixVQUFBQyxlQUFBMUIsS0FBQXVCLEVBQUFDLElBR3REL0IsRUFBQWtDLEVBQUEsR0FJQWxDLElBQUFtQyxFQUFBLG1GQ2pGQSxNQUFBQyxFQUFBcEMsRUFBQSxHQUVBLE1BQWFxQyxVQUFzQkQsRUFBQUUsYUFNakNDLFlBQ3FCQyxFQUNBQyxFQUNBQyxHQUluQixHQUZBQyxRQUptQkMsS0FBQUosb0JBQ0FJLEtBQUFILG9CQUNBRyxLQUFBRixvQkFMWEUsS0FBQUMsYUFBZUMsR0FBRywrQkFRMUJGLEtBQUtILGtCQUFrQk0sSUFBSSw0QkFBNkJMLEdBQ3BETCxFQUFjVyxTQUNoQixPQUFPWCxFQUFjVyxTQUV2QlgsRUFBY1csU0FBV0osS0FNcEJMLDZCQUNMSyxLQUFLQyxhQUFhSSxHQUFHLElBQUssQ0FBQ0MsRUFBc0JDLEtBQy9DUCxLQUFLSCxrQkFBa0JNLFFBQVFILEtBQUtGLGtCQUFrQi9CLHVCQUF3QnVDLEVBQWNDLEdBQzVGUCxLQUFLSixrQkFBa0JZLGlCQUFpQkYsRUFBY0MsRUFBTVAsS0FBS0YsbUJBQ2pFRSxLQUFLUyxLQUFLSCxFQUFjQyxFQUFNUCxLQUFLRixzQkExQnpDeEMsRUFBQW1DLCtGQ0RBLE1BQUFpQixFQUFBdEQsRUFBQSxHQUNBdUQsRUFBQXZELEVBQUEsR0FFQSxJQUFJd0QsRUFBc0MsS0FDdENDLEVBQXdDLEtBTzVDQyxPQUFPQyxTQUFTLDZCQUE4QixDQUU1Q0MsU0FBVSxHQTZCVnJCLFFBQ0VzQixJQUFJZCxRQUFRSCxLQUFLakMsZ0JBQWlCbUQsR0FBSWxCLE1BRXRDWSxFQUFnQixJQUFJRixFQUFBakIsY0FBY3lCLEdBQUlELElBQUtqQixNQUMzQ2EsRUFBaUIsSUFBSUYsRUFBQVEsZUFBZUQsR0FBSUQsSUFBS2pCLE1BQzdDWSxFQUFjUSw4QkFnRWhCekIsY0FFRSxPQURBc0IsSUFBSWQsUUFBUUgsS0FBS2pDLHFCQUNWLElBZVQ0QixxQkFBcUJXLEVBQXNCZSxFQUFjQyxHQUN2REwsSUFBSWQsUUFBUUgsS0FBS2pDLDhCQUE4QnVDLGlCQUE0QmdCLElBQVVELElBUXZGMUIsMkJBQTJCVyxFQUFzQmUsR0FDL0NKLElBQUlkLFFBQVFILEtBQUtqQyxvQ0FBb0N1QyxJQUFnQmUsR0FDakVSLEdBQ21CLGlCQUFqQlAsR0FDRk8sRUFBZVUsYUFBYUYsRUFBUTNELDBDQ3hINUMsSUFPQThELEVBUEFDLEVBQUEsaUJBQUFDLGdCQUFBLEtBQ0FDLEVBQUFGLEdBQUEsbUJBQUFBLEVBQUFHLE1BQ0FILEVBQUFHLE1BQ0EsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQSxPQUFBQyxTQUFBNUMsVUFBQXdDLE1BQUFqRSxLQUFBa0UsRUFBQUMsRUFBQUMsSUFLQVAsRUFEQUMsR0FBQSxtQkFBQUEsRUFBQVEsUUFDQVIsRUFBQVEsUUFDQy9ELE9BQUFnRSxzQkFDRCxTQUFBTCxHQUNBLE9BQUEzRCxPQUFBaUUsb0JBQUFOLEdBQ0FPLE9BQUFsRSxPQUFBZ0Usc0JBQUFMLEtBR0EsU0FBQUEsR0FDQSxPQUFBM0QsT0FBQWlFLG9CQUFBTixJQVFBLElBQUFRLEVBQUFDLE9BQUFDLE9BQUEsU0FBQTlELEdBQ0EsT0FBQUEsTUFHQSxTQUFBaUIsSUFDQUEsRUFBQThDLEtBQUE3RSxLQUFBcUMsTUFFQXpDLEVBQUFELFFBQUFvQyxFQUdBQSxpQkFFQUEsRUFBQU4sVUFBQXFELGFBQUFDLEVBQ0FoRCxFQUFBTixVQUFBdUQsYUFBQSxFQUNBakQsRUFBQU4sVUFBQXdELG1CQUFBRixFQUlBLElBQUFHLEVBQUEsR0FvQ0EsU0FBQUMsRUFBQUMsR0FDQSxZQUFBTCxJQUFBSyxFQUFBSCxjQUNBbEQsRUFBQW1ELG9CQUNBRSxFQUFBSCxjQW1EQSxTQUFBSSxFQUFBbkIsRUFBQW9CLEVBQUFDLEVBQUFDLEdBQ0EsSUFBQXZGLEVBQ0F3RixFQUNBQyxFQW5IQUMsRUFxSEEsc0JBQUFKLEVBQ0EsVUFBQUssVUFBQSwwRUFBQUwsR0FxQkEsUUFqQkFSLEtBREFVLEVBQUF2QixFQUFBWSxVQUVBVyxFQUFBdkIsRUFBQVksUUFBQXZFLE9BQUFZLE9BQUEsTUFDQStDLEVBQUFjLGFBQUEsU0FJQUQsSUFBQVUsRUFBQUksY0FDQTNCLEVBQUFwQixLQUFBLGNBQUF3QyxFQUNBQyx5QkFJQUUsRUFBQXZCLEVBQUFZLFNBRUFZLEVBQUFELEVBQUFILFNBR0FQLElBQUFXLEVBRUFBLEVBQUFELEVBQUFILEdBQUFDLElBQ0FyQixFQUFBYyxrQkFlQSxHQWJBLG1CQUFBVSxFQUVBQSxFQUFBRCxFQUFBSCxHQUNBRSxFQUFBLENBQUFELEVBQUFHLEdBQUEsQ0FBQUEsRUFBQUgsR0FFS0MsRUFDTEUsRUFBQUksUUFBQVAsR0FFQUcsRUFBQUssS0FBQVIsSUFJQXRGLEVBQUFrRixFQUFBakIsSUFDQSxHQUFBd0IsRUFBQU0sT0FBQS9GLElBQUF5RixFQUFBTyxPQUFBLENBQ0FQLEVBQUFPLFFBQUEsRUFHQSxJQUFBQyxFQUFBLElBQUFDLE1BQUEsK0NBQ0FULEVBQUFNLE9BQUEsSUFBQUksT0FBQWQsR0FBQSxxRUFHQVksRUFBQTlGLEtBQUEsOEJBQ0E4RixFQUFBRyxRQUFBbkMsRUFDQWdDLEVBQUFaLE9BQ0FZLEVBQUFJLE1BQUFaLEVBQUFNLE9BeEtBTCxFQXlLQU8sRUF4S0FLLGlCQUFBQyxNQUFBRCxRQUFBQyxLQUFBYixHQTRLQSxPQUFBekIsRUF3QkEsU0FBQXVDLEVBQUF2QyxFQUFBb0IsRUFBQUMsR0FDQSxJQUFBbUIsRUFBQSxDQUFlQyxPQUFBLEVBQUFDLFlBQUE3QixFQUFBYixTQUFBb0IsT0FBQUMsWUFDZnNCLEVBWkEsV0FFQSxJQURBLElBQUF6QyxFQUFBLEdBQ0F2RSxFQUFBLEVBQWlCQSxFQUFBaUgsVUFBQWQsT0FBc0JuRyxJQUFBdUUsRUFBQTJCLEtBQUFlLFVBQUFqSCxJQUN2Q3dDLEtBQUFzRSxRQUNBdEUsS0FBQTZCLE9BQUE2QyxlQUFBMUUsS0FBQWlELEtBQUFqRCxLQUFBdUUsUUFDQXZFLEtBQUFzRSxPQUFBLEVBQ0EzQyxFQUFBM0IsS0FBQWtELFNBQUFsRCxLQUFBNkIsT0FBQUUsS0FNQS9DLEtBQUFxRixHQUdBLE9BRkFHLEVBQUF0QixXQUNBbUIsRUFBQUUsT0FBQUMsRUFDQUEsRUFnSUEsU0FBQUcsRUFBQTlDLEVBQUFvQixFQUFBMkIsR0FDQSxJQUFBeEIsRUFBQXZCLEVBQUFZLFFBRUEsUUFBQUMsSUFBQVUsRUFDQSxTQUVBLElBQUF5QixFQUFBekIsRUFBQUgsR0FDQSxZQUFBUCxJQUFBbUMsRUFDQSxHQUVBLG1CQUFBQSxFQUNBRCxFQUFBLENBQUFDLEVBQUEzQixVQUFBMkIsR0FBQSxDQUFBQSxHQUVBRCxFQXNEQSxTQUFBRSxHQUVBLElBREEsSUFBQUMsRUFBQSxJQUFBQyxNQUFBRixFQUFBbkIsUUFDQW5HLEVBQUEsRUFBaUJBLEVBQUF1SCxFQUFBcEIsU0FBZ0JuRyxFQUNqQ3VILEVBQUF2SCxHQUFBc0gsRUFBQXRILEdBQUEwRixVQUFBNEIsRUFBQXRILEdBRUEsT0FBQXVILEVBMURBRSxDQUFBSixHQUFBSyxFQUFBTCxJQUFBbEIsUUFvQkEsU0FBQXdCLEVBQUFsQyxHQUNBLElBQUFHLEVBQUFwRCxLQUFBeUMsUUFFQSxRQUFBQyxJQUFBVSxFQUFBLENBQ0EsSUFBQXlCLEVBQUF6QixFQUFBSCxHQUVBLHNCQUFBNEIsRUFDQSxTQUNLLFFBQUFuQyxJQUFBbUMsRUFDTCxPQUFBQSxFQUFBbEIsT0FJQSxTQU9BLFNBQUF1QixFQUFBSixFQUFBN0YsR0FFQSxJQURBLElBQUFtRyxFQUFBLElBQUFKLE1BQUEvRixHQUNBekIsRUFBQSxFQUFpQkEsRUFBQXlCLElBQU96QixFQUN4QjRILEVBQUE1SCxHQUFBc0gsRUFBQXRILEdBQ0EsT0FBQTRILEVBNVdBbEgsT0FBQUMsZUFBQXVCLEVBQUEsdUJBQ0F0QixZQUFBLEVBQ0FDLElBQUEsV0FDQSxPQUFBd0UsR0FFQXdDLElBQUEsU0FBQUMsR0FDQSxvQkFBQUEsS0FBQSxHQUFBakQsRUFBQWlELEdBQ0EsVUFBQUMsV0FBQSxrR0FBQUQsRUFBQSxLQUVBekMsRUFBQXlDLEtBSUE1RixFQUFBOEMsS0FBQSxnQkFFQUUsSUFBQTFDLEtBQUF5QyxTQUNBekMsS0FBQXlDLFVBQUF2RSxPQUFBc0gsZUFBQXhGLE1BQUF5QyxVQUNBekMsS0FBQXlDLFFBQUF2RSxPQUFBWSxPQUFBLE1BQ0FrQixLQUFBMkMsYUFBQSxHQUdBM0MsS0FBQTRDLGNBQUE1QyxLQUFBNEMsb0JBQUFGLEdBS0FoRCxFQUFBTixVQUFBcUcsZ0JBQUEsU0FBQXhHLEdBQ0Esb0JBQUFBLEtBQUEsR0FBQW9ELEVBQUFwRCxHQUNBLFVBQUFzRyxXQUFBLGdGQUFBdEcsRUFBQSxLQUdBLE9BREFlLEtBQUE0QyxjQUFBM0QsRUFDQWUsTUFTQU4sRUFBQU4sVUFBQXNHLGdCQUFBLFdBQ0EsT0FBQTVDLEVBQUE5QyxPQUdBTixFQUFBTixVQUFBcUIsS0FBQSxTQUFBd0MsR0FFQSxJQURBLElBQUFsQixFQUFBLEdBQ0F2RSxFQUFBLEVBQWlCQSxFQUFBaUgsVUFBQWQsT0FBc0JuRyxJQUFBdUUsRUFBQTJCLEtBQUFlLFVBQUFqSCxJQUN2QyxJQUFBbUksRUFBQSxVQUFBMUMsRUFFQUcsRUFBQXBELEtBQUF5QyxRQUNBLFFBQUFDLElBQUFVLEVBQ0F1QyxVQUFBakQsSUFBQVUsRUFBQXdDLFdBQ0EsSUFBQUQsRUFDQSxTQUdBLEdBQUFBLEVBQUEsQ0FDQSxJQUFBRSxFQUdBLEdBRkE5RCxFQUFBNEIsT0FBQSxJQUNBa0MsRUFBQTlELEVBQUEsSUFDQThELGFBQUEvQixNQUdBLE1BQUErQixFQUdBLElBQUFDLEVBQUEsSUFBQWhDLE1BQUEsb0JBQUErQixFQUFBLEtBQUFBLEVBQUFFLFFBQUEsU0FFQSxNQURBRCxFQUFBRSxRQUFBSCxFQUNBQyxFQUdBLElBQUFHLEVBQUE3QyxFQUFBSCxHQUVBLFFBQUFQLElBQUF1RCxFQUNBLFNBRUEsc0JBQUFBLEVBQ0F0RSxFQUFBc0UsRUFBQWpHLEtBQUErQixPQUVBLEtBQUFtRSxFQUFBRCxFQUFBdEMsT0FDQXdDLEVBQUFqQixFQUFBZSxFQUFBQyxHQUNBLElBQUExSSxFQUFBLEVBQW1CQSxFQUFBMEksSUFBUzFJLEVBQzVCbUUsRUFBQXdFLEVBQUEzSSxHQUFBd0MsS0FBQStCLEdBR0EsVUFtRUFyQyxFQUFBTixVQUFBZ0gsWUFBQSxTQUFBbkQsRUFBQUMsR0FDQSxPQUFBRixFQUFBaEQsS0FBQWlELEVBQUFDLEdBQUEsSUFHQXhELEVBQUFOLFVBQUFpQixHQUFBWCxFQUFBTixVQUFBZ0gsWUFFQTFHLEVBQUFOLFVBQUFpSCxnQkFDQSxTQUFBcEQsRUFBQUMsR0FDQSxPQUFBRixFQUFBaEQsS0FBQWlELEVBQUFDLEdBQUEsSUFxQkF4RCxFQUFBTixVQUFBa0gsS0FBQSxTQUFBckQsRUFBQUMsR0FDQSxzQkFBQUEsRUFDQSxVQUFBSyxVQUFBLDBFQUFBTCxHQUdBLE9BREFsRCxLQUFBSyxHQUFBNEMsRUFBQW1CLEVBQUFwRSxLQUFBaUQsRUFBQUMsSUFDQWxELE1BR0FOLEVBQUFOLFVBQUFtSCxvQkFDQSxTQUFBdEQsRUFBQUMsR0FDQSxzQkFBQUEsRUFDQSxVQUFBSyxVQUFBLDBFQUFBTCxHQUdBLE9BREFsRCxLQUFBcUcsZ0JBQUFwRCxFQUFBbUIsRUFBQXBFLEtBQUFpRCxFQUFBQyxJQUNBbEQsTUFJQU4sRUFBQU4sVUFBQXNGLGVBQ0EsU0FBQXpCLEVBQUFDLEdBQ0EsSUFBQXNELEVBQUFwRCxFQUFBcUQsRUFBQWpKLEVBQUFrSixFQUVBLHNCQUFBeEQsRUFDQSxVQUFBSyxVQUFBLDBFQUFBTCxHQUlBLFFBQUFSLEtBREFVLEVBQUFwRCxLQUFBeUMsU0FFQSxPQUFBekMsS0FHQSxRQUFBMEMsS0FEQThELEVBQUFwRCxFQUFBSCxJQUVBLE9BQUFqRCxLQUVBLEdBQUF3RyxJQUFBdEQsR0FBQXNELEVBQUF0RCxhQUNBLEtBQUFsRCxLQUFBMkMsYUFDQTNDLEtBQUF5QyxRQUFBdkUsT0FBQVksT0FBQSxjQUVBc0UsRUFBQUgsR0FDQUcsRUFBQXNCLGdCQUNBMUUsS0FBQVMsS0FBQSxpQkFBQXdDLEVBQUF1RCxFQUFBdEQsbUJBRU8sc0JBQUFzRCxFQUFBLENBR1AsSUFGQUMsR0FBQSxFQUVBakosRUFBQWdKLEVBQUE3QyxPQUFBLEVBQWlDbkcsR0FBQSxFQUFRQSxJQUN6QyxHQUFBZ0osRUFBQWhKLEtBQUEwRixHQUFBc0QsRUFBQWhKLEdBQUEwRixhQUFBLENBQ0F3RCxFQUFBRixFQUFBaEosR0FBQTBGLFNBQ0F1RCxFQUFBakosRUFDQSxNQUlBLEdBQUFpSixFQUFBLEVBQ0EsT0FBQXpHLEtBRUEsSUFBQXlHLEVBQ0FELEVBQUFHLFFBaUlBLFNBQUFILEVBQUFJLEdBQ0EsS0FBUUEsRUFBQSxFQUFBSixFQUFBN0MsT0FBeUJpRCxJQUNqQ0osRUFBQUksR0FBQUosRUFBQUksRUFBQSxHQUNBSixFQUFBSyxNQWxJQUMsQ0FBQU4sRUFBQUMsR0FHQSxJQUFBRCxFQUFBN0MsU0FDQVAsRUFBQUgsR0FBQXVELEVBQUEsU0FFQTlELElBQUFVLEVBQUFzQixnQkFDQTFFLEtBQUFTLEtBQUEsaUJBQUF3QyxFQUFBeUQsR0FBQXhELEdBR0EsT0FBQWxELE1BR0FOLEVBQUFOLFVBQUEySCxJQUFBckgsRUFBQU4sVUFBQXNGLGVBRUFoRixFQUFBTixVQUFBNEgsbUJBQ0EsU0FBQS9ELEdBQ0EsSUFBQWtELEVBQUEvQyxFQUFBNUYsRUFHQSxRQUFBa0YsS0FEQVUsRUFBQXBELEtBQUF5QyxTQUVBLE9BQUF6QyxLQUdBLFFBQUEwQyxJQUFBVSxFQUFBc0IsZUFVQSxPQVRBLElBQUFELFVBQUFkLFFBQ0EzRCxLQUFBeUMsUUFBQXZFLE9BQUFZLE9BQUEsTUFDQWtCLEtBQUEyQyxhQUFBLFFBQ1NELElBQUFVLEVBQUFILEtBQ1QsS0FBQWpELEtBQUEyQyxhQUNBM0MsS0FBQXlDLFFBQUF2RSxPQUFBWSxPQUFBLGFBRUFzRSxFQUFBSCxJQUVBakQsS0FJQSxPQUFBeUUsVUFBQWQsT0FBQSxDQUNBLElBQ0E1RSxFQURBa0ksRUFBQS9JLE9BQUErSSxLQUFBN0QsR0FFQSxJQUFBNUYsRUFBQSxFQUFtQkEsRUFBQXlKLEVBQUF0RCxTQUFpQm5HLEVBRXBDLG9CQURBdUIsRUFBQWtJLEVBQUF6SixLQUVBd0MsS0FBQWdILG1CQUFBakksR0FLQSxPQUhBaUIsS0FBQWdILG1CQUFBLGtCQUNBaEgsS0FBQXlDLFFBQUF2RSxPQUFBWSxPQUFBLE1BQ0FrQixLQUFBMkMsYUFBQSxFQUNBM0MsS0FLQSxzQkFGQW1HLEVBQUEvQyxFQUFBSCxJQUdBakQsS0FBQTBFLGVBQUF6QixFQUFBa0QsUUFDTyxRQUFBekQsSUFBQXlELEVBRVAsSUFBQTNJLEVBQUEySSxFQUFBeEMsT0FBQSxFQUFzQ25HLEdBQUEsRUFBUUEsSUFDOUN3QyxLQUFBMEUsZUFBQXpCLEVBQUFrRCxFQUFBM0ksSUFJQSxPQUFBd0MsTUFvQkFOLEVBQUFOLFVBQUErRyxVQUFBLFNBQUFsRCxHQUNBLE9BQUEwQixFQUFBM0UsS0FBQWlELEdBQUEsSUFHQXZELEVBQUFOLFVBQUE4SCxhQUFBLFNBQUFqRSxHQUNBLE9BQUEwQixFQUFBM0UsS0FBQWlELEdBQUEsSUFHQXZELEVBQUF5RixjQUFBLFNBQUFuQixFQUFBZixHQUNBLHlCQUFBZSxFQUFBbUIsY0FDQW5CLEVBQUFtQixjQUFBbEMsR0FFQWtDLEVBQUF4SCxLQUFBcUcsRUFBQWYsSUFJQXZELEVBQUFOLFVBQUErRixnQkFpQkF6RixFQUFBTixVQUFBK0gsV0FBQSxXQUNBLE9BQUFuSCxLQUFBMkMsYUFBQSxFQUFBbkIsRUFBQXhCLEtBQUF5QyxTQUFBLG1GQ3hhQSxNQUFBL0IsRUFBQXRELEVBQUEsR0FFQSxNQUFhK0QsRUFNWHhCLFlBQ3FCQyxFQUNBQyxFQUNBQyxHQUduQixHQUxtQkUsS0FBQUosb0JBQ0FJLEtBQUFILG9CQUNBRyxLQUFBRixvQkFFbkJFLEtBQUtZLGNBQWdCLElBQUlGLEVBQUFqQixjQUFjRyxFQUFtQkMsRUFBbUJDLEdBQ3pFcUIsRUFBZWYsU0FDakIsT0FBT2UsRUFBZWYsU0FFeEJlLEVBQWVmLFNBQVdKLEtBRTFCQSxLQUFLWSxjQUFjUCxHQUFHLGVBQWlCZ0IsSUFDckNyQixLQUFLSCxrQkFBa0JNLElBQUksaUJBQWtCa0IsR0FDN0NyQixLQUFLb0gsVUFDTHBILEtBQUt1QixhQUFhRixFQUFRM0QsV0FJOUJpQyxNQUFNMEgsR0FDSixJQUFJQyxFQU1KLE9BTEF0SCxLQUFLSixrQkFBa0IySCxhQUFhQyxVQUFXakssSUFDekM4SixJQUFVOUosRUFBT1EsT0FDbkJ1SixFQUFLL0osRUFBT2tLLGNBR1RILEVBR1QzSCxVQUNFSyxLQUFLSixrQkFBa0IySCxhQUFhQyxVQUFXakssSUFDN0NBLEVBQU9tSyxTQUlYL0gsYUFBYWdJLEdBQ1gzSCxLQUFLSCxrQkFBa0JNLElBQUksZUFBZ0J3SCxHQUMzQyxJQUFLLE1BQU1DLEtBQWtCRCxFQUFpQixDQUM1QyxNQUFNRSxFQUFhRCxFQUFlckssT0FBT0EsT0FDbkMrSixFQUFLdEgsS0FBSzhILE1BQU1ELEdBQ3RCN0gsS0FBS0gsa0JBQWtCTSxJQUFJLEtBQU1tSCxHQUNqQ3RILEtBQUtKLGtCQUFrQjJILGFBQWFRLFVBQVVGLEdBQVlMLFVBQVdqSyxJQUNuRSxHQUFJcUssRUFBZW5CLFNBQVUsQ0FDM0IsTUFBTXVCLEVBQWdCSixFQUFlbkIsU0FBU3dCLE1BQU0sS0FDOUNDLEVBQWlCQyxTQUFTQyxlQUFlZCxHQUN6Q2UsRUFBU0YsU0FBU0csY0FBYyxjQUFnQk4sRUFBYyxHQUFLLElBQU1BLEVBQWMsR0FBSyxrQkFFbEdoSSxLQUFLSCxrQkFBa0JNLElBQUksZUFBZ0J5SCxFQUFlN0osTUFHN0IsU0FBekJzSyxFQUFPRSxNQUFNQyxVQUNmSCxFQUFPRSxNQUFNQyxRQUFVLFNBSXpCSCxFQUFPSSxZQUFZUCxJQUtVLElBQTNCTixFQUFlYyxRQUNqQm5MLEVBQU9vTCxRQUk2QixJQUEzQmYsRUFBZWMsU0FDeEJuTCxFQUFPbUssVUFTZi9ILGNBQ0VLLEtBQUtKLGtCQUFrQjJILGFBQWFDLFVBQVdqSyxJQUM3QyxHQUFJQSxFQUFPZ0QsS0FBS2tHLFNBQVUsQ0FDeEIsTUFBTXVCLEVBQWdCekssRUFBT2dELEtBQUtrRyxTQUFTd0IsTUFBTSxLQUMzQ0MsRUFBaUJDLFNBQVNDLGVBQWU3SyxFQUFPa0ssWUFDaERZLEVBQVNGLFNBQVNHLGNBQWMsY0FBZ0JOLEVBQWMsR0FBSyxJQUFNQSxFQUFjLEdBQUssa0JBR3JFLFNBQXpCSyxFQUFPRSxNQUFNQyxVQUNmSCxFQUFPRSxNQUFNQyxRQUFVLFNBSXpCSCxFQUFPSSxZQUFZUCxHQUduQjNLLEVBQU9vTCxLQUFLLElBQU0sWUFoRzFCckwsRUFBQTZEIiwiZmlsZSI6Im1tbS1wdWJsaWMtc2lnbmFnZS1kaXNwbGF5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDEpO1xuIiwiaW1wb3J0IHsgSU1hZ2ljTWlycm9ySGVscGVyLCBJTU1Mb2csIElDbGllbnRNb2R1bGVJbnN0YW5jZVByb3BlcnRpZXMgfSBmcm9tICcuLi9pbnRlcmZhY2VzJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ2V2ZW50cyc7XG5cbmV4cG9ydCBjbGFzcyBTb2NrZXRTZXJ2aWNlIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcblxuICBwdWJsaWMgc3RhdGljIGluc3RhbmNlPzogU29ja2V0U2VydmljZTtcblxuICBwcm90ZWN0ZWQgc29ja2V0TW9kdWxlID0gaW8oJy9tbW0tcHVibGljLXNpZ25hZ2UtZGlzcGxheScpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCByZWFkb25seSBtYWdpY01pcnJvckhlbHBlcjogSU1hZ2ljTWlycm9ySGVscGVyLFxuICAgIHByb3RlY3RlZCByZWFkb25seSBtYWdpY01pcnJvckxvZ2dlcjogSU1NTG9nLFxuICAgIHByb3RlY3RlZCByZWFkb25seSBtYWdpY01pcnJvck1vZHVsZTogSUNsaWVudE1vZHVsZUluc3RhbmNlUHJvcGVydGllcyxcbiAgKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLm1hZ2ljTWlycm9yTG9nZ2VyLmxvZygnU29ja2V0U2VydmljZSBjb25zdHJ1Y3RvcicsIG1hZ2ljTWlycm9yTW9kdWxlKTtcbiAgICBpZiAoU29ja2V0U2VydmljZS5pbnN0YW5jZSkge1xuICAgICAgcmV0dXJuIFNvY2tldFNlcnZpY2UuaW5zdGFuY2U7XG4gICAgfVxuICAgIFNvY2tldFNlcnZpY2UuaW5zdGFuY2UgPSB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcndhcmQgYCpgIG5vdGlmaWNhdGlvbnMgdG8gYWxsIG1vZHVsZXNcbiAgICovXG4gIHB1YmxpYyBpbml0Tm90aWZpY2F0aW9uRm9yd2FyZGluZygpIHtcbiAgICB0aGlzLnNvY2tldE1vZHVsZS5vbignKicsIChub3RpZmljYXRpb246IHN0cmluZywgZGF0YTogYW55KSA9PiB7XG4gICAgICB0aGlzLm1hZ2ljTWlycm9yTG9nZ2VyLmxvZyhgWyR7dGhpcy5tYWdpY01pcnJvck1vZHVsZS5uYW1lfV0gKiBub3RpZmljYXRpb25gLCBub3RpZmljYXRpb24sIGRhdGEpO1xuICAgICAgdGhpcy5tYWdpY01pcnJvckhlbHBlci5zZW5kTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbiwgZGF0YSwgdGhpcy5tYWdpY01pcnJvck1vZHVsZSk7XG4gICAgICB0aGlzLmVtaXQobm90aWZpY2F0aW9uLCBkYXRhLCB0aGlzLm1hZ2ljTWlycm9yTW9kdWxlKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgSU1NTG9nLCBJTW9kdWxlUmVnaXN0ZXIsIElDbGllbnRNb2R1bGVJbnN0YW5jZSwgSU1hZ2ljTWlycm9ySGVscGVyIH0gZnJvbSAnLi9pbnRlcmZhY2VzJztcbmltcG9ydCB7IE1hbmFnZXIgfSBmcm9tICdzb2NrZXQuaW8tY2xpZW50JztcbmltcG9ydCB7IFNvY2tldFNlcnZpY2UgfSBmcm9tICcuL2NsaWVudC9zb2NrZXQuc2VydmljZSc7XG5pbXBvcnQgeyBNb2R1bGVzU2VydmljZSB9IGZyb20gJy4vY2xpZW50L21vZHVsZXMuc2VydmljZSc7XG5cbmxldCBzb2NrZXRTZXJ2aWNlOiBTb2NrZXRTZXJ2aWNlIHwgbnVsbCA9IG51bGw7XG5sZXQgbW9kdWxlc1NlcnZpY2U6IE1vZHVsZXNTZXJ2aWNlIHwgbnVsbCA9IG51bGw7XG5cbmRlY2xhcmUgY29uc3QgTW9kdWxlOiBJTW9kdWxlUmVnaXN0ZXI7XG5kZWNsYXJlIGNvbnN0IExvZzogSU1NTG9nO1xuZGVjbGFyZSBjb25zdCBNTTogSU1hZ2ljTWlycm9ySGVscGVyO1xuZGVjbGFyZSBjb25zdCBpbzogdHlwZW9mIE1hbmFnZXI7XG5cbk1vZHVsZS5yZWdpc3RlcignbW1tLXB1YmxpYy1zaWduYWdlLWRpc3BsYXknLCB7XG4gIC8vIERlZmF1bHQgbW9kdWxlIGNvbmZpZy5cbiAgZGVmYXVsdHM6IHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2hlbiBhIG1vZHVsZSBnZXRzIGluc3RhbnRpYXRlZC5cbiAgICogSW4gbW9zdCBjYXNlcyB5b3UgZG8gbm90IG5lZWQgdG8gc3ViY2xhc3MgdGhpcyBtZXRob2QuXG4gICAqL1xuICAvLyBpbml0KCk6IHZvaWQge1xuICAvLyAgIExvZy5sb2coYFske3RoaXMubmFtZX1dIGluaXRgKTtcbiAgLy8gfSxcblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIHdoZW4gYSBtb2R1bGUgaXMgbG9hZGVkLlxuICAgKiBTdWJzZXF1ZW50IG1vZHVsZXMgaW4gdGhlIGNvbmZpZyBhcmUgbm90IHlldCBsb2FkZWQuXG4gICAqIFRoZSBjYWxsYmFjayBmdW5jdGlvbiBNVVNUIGJlIGNhbGxlZCB3aGVuIHRoZSBtb2R1bGUgaXMgZG9uZSBsb2FkaW5nLlxuICAgKiBJbiBtb3N0IGNhc2VzIHlvdSBkbyBub3QgbmVlZCB0byBzdWJjbGFzcyB0aGlzIG1ldGhvZC5cbiAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAqL1xuICAvLyBsb2FkZWQoY2FsbGJhY2s6ICgpID0+IHZvaWQpOiB2b2lkIHtcbiAgLy8gICBMb2cubG9nKGBbJHt0aGlzLm5hbWV9XSBsb2FkZWRgKTtcbiAgLy8gICBjYWxsYmFjaygpO1xuICAvLyB9LFxuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2hlbiBhbGwgbW9kdWxlcyBhcmUgbG9hZGVkIGFuIHRoZSBzeXN0ZW0gaXMgcmVhZHkgdG8gYm9vdCB1cC5cbiAgICogS2VlcCBpbiBtaW5kIHRoYXQgdGhlIGRvbSBvYmplY3QgZm9yIHRoZSBtb2R1bGUgaXMgbm90IHlldCBjcmVhdGVkLlxuICAgKiBUaGUgc3RhcnQgbWV0aG9kIGlzIGEgcGVyZmVjdCBwbGFjZSB0byBkZWZpbmUgYW55IGFkZGl0aW9uYWwgbW9kdWxlIHByb3BlcnRpZXMuXG4gICAqL1xuICBzdGFydCgpOiB2b2lkIHtcbiAgICBMb2cubG9nKGBbJHt0aGlzLm5hbWV9XSBzdGFydGVkYCwgTU0sIHRoaXMpO1xuXG4gICAgc29ja2V0U2VydmljZSA9IG5ldyBTb2NrZXRTZXJ2aWNlKE1NLCBMb2csIHRoaXMpO1xuICAgIG1vZHVsZXNTZXJ2aWNlID0gbmV3IE1vZHVsZXNTZXJ2aWNlKE1NLCBMb2csIHRoaXMpO1xuICAgIHNvY2tldFNlcnZpY2UuaW5pdE5vdGlmaWNhdGlvbkZvcndhcmRpbmcoKTtcbiAgfSxcblxuICAvKipcbiAgICogVGhlIGdldFNjcmlwdHMgbWV0aG9kIGlzIGNhbGxlZCB0byByZXF1ZXN0IGFueSBhZGRpdGlvbmFsIHNjcmlwdHMgdGhhdCBuZWVkIHRvIGJlIGxvYWRlZC5cbiAgICogVGhpcyBtZXRob2Qgc2hvdWxkIHRoZXJlZm9yZSByZXR1cm4gYW4gYXJyYXkgd2l0aCBzdHJpbmdzLlxuICAgKiBJZiB5b3Ugd2FudCB0byByZXR1cm4gYSBmdWxsIHBhdGggdG8gYSBmaWxlIGluIHRoZSBtb2R1bGUgZm9sZGVyLCB1c2UgdGhlIGB0aGlzLmZpbGUoJ2ZpbGVuYW1lLmpzJylgIG1ldGhvZC5cbiAgICogSW4gYWxsIGNhc2VzIHRoZSBsb2FkZXIgd2lsbCBvbmx5IGxvYWQgYSBmaWxlIG9uY2UuXG4gICAqIEl0IGV2ZW4gY2hlY2tzIGlmIHRoZSBmaWxlIGlzIGF2YWlsYWJsZSBpbiB0aGUgZGVmYXVsdCB2ZW5kb3IgZm9sZGVyLlxuICAgKi9cbiAgLy8gZ2V0U2NyaXB0cygpOiBzdHJpbmdbXSB7XG4gIC8vICAgcmV0dXJuIFt0aGlzLmZpbGUoJ2NsaWVudC9zY3JpcHRzL2FwcC5qcycpXTtcbiAgLy8gfSxcblxuICAvKipcbiAgICogVGhlIGdldFN0eWxlcyBtZXRob2QgaXMgY2FsbGVkIHRvIHJlcXVlc3QgYW55IGFkZGl0aW9uYWwgc3R5bGVzaGVldHMgdGhhdCBuZWVkIHRvIGJlIGxvYWRlZC5cbiAgICogVGhpcyBtZXRob2Qgc2hvdWxkIHRoZXJlZm9yZSByZXR1cm4gYW4gYXJyYXkgd2l0aCBzdHJpbmdzLlxuICAgKiBJZiB5b3Ugd2FudCB0byByZXR1cm4gYSBmdWxsIHBhdGggdG8gYSBmaWxlIGluIHRoZSBtb2R1bGUgZm9sZGVyLCB1c2UgdGhlIGB0aGlzLmZpbGUoJ2ZpbGVuYW1lLmNzcycpYCBtZXRob2QuXG4gICAqIEluIGFsbCBjYXNlcyB0aGUgbG9hZGVyIHdpbGwgb25seSBsb2FkIGEgZmlsZSBvbmNlLlxuICAgKiBJdCBldmVuIGNoZWNrcyBpZiB0aGUgZmlsZSBpcyBhdmFpbGFibGUgaW4gdGhlIGRlZmF1bHQgdmVuZG9yIGZvbGRlci5cbiAgICovXG4gIC8vIGdldFN0eWxlcygpOiBzdHJpbmdbXSB7XG4gIC8vICAgcmV0dXJuIFt0aGlzLmZpbGUoJ2NsaWVudC9zdHlsZXMvbW9kdWxlLWNvbnRyb2wuY3NzJyldO1xuICAvLyB9LFxuXG4gIC8qKlxuICAgKiBUaGUgZ2V0VHJhbnNsYXRpb25zIG1ldGhvZCBpcyBjYWxsZWQgdG8gcmVxdWVzdCB0cmFuc2xhdGlvbiBmaWxlcyB0aGF0IG5lZWQgdG8gYmUgbG9hZGVkLlxuICAgKiBUaGlzIG1ldGhvZCBzaG91bGQgdGhlcmVmb3JlIHJldHVybiBhIGRpY3Rpb25hcnkgd2l0aCB0aGUgZmlsZXMgdG8gbG9hZCwgaWRlbnRpZmllZCBieSB0aGUgY291bnRyeSdzIHNob3J0IG5hbWUuXG4gICAqIElmIHRoZSBtb2R1bGUgZG9lcyBub3QgaGF2ZSBhbnkgbW9kdWxlIHNwZWNpZmljIHRyYW5zbGF0aW9ucywgdGhlIGZ1bmN0aW9uIGNhbiBqdXN0IGJlIG9taXR0ZWQgb3IgcmV0dXJuIGBmYWxzZWAuXG4gICAqL1xuICAvLyBnZXRUcmFuc2xhdGlvbnMoKSB7XG4gIC8vICAgTG9nLmxvZyhgWyR7dGhpcy5uYW1lfV0gZ2V0VHJhbnNsYXRpb25zYCk7XG4gIC8vICAgcmV0dXJuIHtcbiAgLy8gICAgIGVuOiAndHJhbnNsYXRpb25zL2VuLmpzb24nLFxuICAvLyAgICAgZGU6ICd0cmFuc2xhdGlvbnMvZGUuanNvbidcbiAgLy8gICB9XG4gIC8vIH0sXG5cbiAgLyoqXG4gICAqIFdoZW5ldmVyIHRoZSBNYWdpY01pcnJvciBuZWVkcyB0byB1cGRhdGUgdGhlIGluZm9ybWF0aW9uIG9uIHNjcmVlblxuICAgKiAoYmVjYXVzZSBpdCBzdGFydHMsIG9yIGJlY2F1c2UgeW91ciBtb2R1bGUgYXNrZWQgYSByZWZyZXNoIHVzaW5nIHRoaXMudXBkYXRlRG9tKCkpLFxuICAgKiB0aGUgc3lzdGVtIGNhbGxzIHRoZSBnZXREb20gbWV0aG9kLiBUaGlzIG1ldGhvZCBzaG91bGQgdGhlcmVmb3JlIHJldHVybiBhIGRvbSBvYmplY3QuXG4gICAqL1xuICAvLyBnZXREb20oKTogSFRNTEVsZW1lbnQge1xuICAvLyAgIExvZy5sb2coYFske3RoaXMubmFtZX1dIGdldERvbWApO1xuICAvLyAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgLy8gICB3cmFwcGVyLmlubmVySFRNTCA9ICdIZWxsbyB3b3JsZCEnO1xuICAvLyAgIHJldHVybiB3cmFwcGVyO1xuICAvLyB9LFxuXG4gIC8qKlxuICAgKiBXaGVuZXZlciB0aGUgTWFnaWNNaXJyb3IgbmVlZHMgdG8gdXBkYXRlIHRoZSBpbmZvcm1hdGlvbiBvbiBzY3JlZW4gKGJlY2F1c2UgaXQgc3RhcnRzLFxuICAgKiBvciBiZWNhdXNlIHlvdXIgbW9kdWxlIGFza2VkIGEgcmVmcmVzaCB1c2luZyBgdGhpcy51cGRhdGVEb20oKWApLFxuICAgKiB0aGUgc3lzdGVtIGNhbGxzIHRoZSBnZXRIZWFkZXIgbWV0aG9kIHRvIHJldHJpZXZlIHRoZSBtb2R1bGUncyBoZWFkZXIuXG4gICAqIFRoaXMgbWV0aG9kIHNob3VsZCB0aGVyZWZvciByZXR1cm4gYSBzdHJpbmcuIElmIHRoaXMgbWV0aG9kIGlzIG5vdCBzdWJjbGFzc2VkLFxuICAgKiB0aGlzIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIHRoZSB1c2VyJ3MgY29uZmlndXJlZCBoZWFkZXIuXG4gICAqXG4gICAqIElmIHlvdSB3YW50IHRvIHVzZSB0aGUgb3JpZ2luYWwgdXNlcidzIGNvbmZpZ3VyZWQgaGVhZGVyLCByZWZlcmVuY2UgYHRoaXMuZGF0YS5oZWFkZXJgLlxuICAgKi9cbiAgLy8gZ2V0SGVhZGVyKCk6IHN0cmluZyB7XG4gIC8vICAgTG9nLmxvZyhgWyR7dGhpcy5uYW1lfV0gZ2V0SGVhZGVyYCk7XG4gIC8vICAgcmV0dXJuIHRoaXMuZGF0YS5oZWFkZXI7XG4gIC8vIH0sXG5cbiAgZ2V0VGVtcGxhdGUoKTogc3RyaW5nIHtcbiAgICBMb2cubG9nKGBbJHt0aGlzLm5hbWV9XSBnZXRUZW1wbGF0ZWApO1xuICAgIHJldHVybiAnJztcbiAgfSxcblxuICAvLyBnZXRUZW1wbGF0ZURhdGEoKTogb2JqZWN0IHtcbiAgLy8gICBMb2cubG9nKGBbJHt0aGlzLm5hbWV9XSBnZXRUZW1wbGF0ZURhdGFgKTtcbiAgLy8gICByZXR1cm4gdGhpcy5jb25maWc7XG4gIC8vIH0sXG5cbiAgLyoqXG4gICAqIFRoYXQgTWFnaWNNaXJyb3IgY29yZSBoYXMgdGhlIGFiaWxpdHkgdG8gc2VuZCBub3RpZmljYXRpb25zIHRvIG1vZHVsZXMuXG4gICAqIE9yIGV2ZW4gYmV0dGVyOiB0aGUgbW9kdWxlcyBoYXZlIHRoZSBwb3NzaWJpbGl0eSB0byBzZW5kIG5vdGlmaWNhdGlvbnMgdG8gb3RoZXIgbW9kdWxlcy5cbiAgICogQHBhcmFtIG5vdGlmaWNhdGlvbiBUaGUgbm90aWZpY2F0aW9uIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSBwYXlsb2FkIFRoZSBwYXlsb2FkIG9mIGEgbm90aWZpY2F0aW9uLlxuICAgKiBAcGFyYW0gc2VuZGVyIGhlIHNlbmRlciBvZiB0aGUgbm90aWZpY2F0aW9uLiBJZiB0aGlzIGFyZ3VtZW50IGlzIGB1bmRlZmluZWRgLCB0aGUgc2VuZGVyIG9mIHRoZSBub3RpZmlmaWN0aW9uIGlzIHRoZSBjb3JlIHN5c3RlbS5cbiAgICovXG4gIG5vdGlmaWNhdGlvblJlY2VpdmVkKG5vdGlmaWNhdGlvbjogc3RyaW5nLCBwYXlsb2FkOiBhbnksIHNlbmRlcj86IGFueSk6IHZvaWQge1xuICAgIExvZy5sb2coYFske3RoaXMubmFtZX1dIG5vdGlmaWNhdGlvblJlY2VpdmVkICR7bm90aWZpY2F0aW9ufSBmcm9tIHNlbmRlciAke3NlbmRlcn1gLCBwYXlsb2FkKTtcbiAgfSxcblxuICAvKipcbiAgICogV2hlbiB1c2luZyBhIG5vZGVfaGVscGVyLCB0aGUgbm9kZSBoZWxwZXIgY2FuIHNlbmQgeW91ciBtb2R1bGUgbm90aWZpY2F0aW9ucy5cbiAgICogQHBhcmFtIG5vdGlmaWNhdGlvbiBUaGUgbm90aWZpY2F0aW9uIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSBwYXlsb2FkIFRoZSBwYXlsb2FkIG9mIGEgbm90aWZpY2F0aW9uLlxuICAgKi9cbiAgc29ja2V0Tm90aWZpY2F0aW9uUmVjZWl2ZWQobm90aWZpY2F0aW9uOiBzdHJpbmcsIHBheWxvYWQ6IGFueSkge1xuICAgIExvZy5sb2coYFske3RoaXMubmFtZX1dIHNvY2tldE5vdGlmaWNhdGlvblJlY2VpdmVkICR7bm90aWZpY2F0aW9ufWAsIHBheWxvYWQpO1xuICAgIGlmIChtb2R1bGVzU2VydmljZSkge1xuICAgICAgaWYgKG5vdGlmaWNhdGlvbiA9PT0gJ1NIT1dfTU9EVUxFUycpIHtcbiAgICAgICAgbW9kdWxlc1NlcnZpY2Uuc2V0UG9zaXRpb25zKHBheWxvYWQubW9kdWxlcyk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBXaGVuIGEgbW9kdWxlIGlzIGhpZGRlbiAodXNpbmcgdGhlIG1vZHVsZS5oaWRlKCkgbWV0aG9kKSwgdGhlIHN1c3BlbmQoKSBtZXRob2Qgd2lsbCBiZSBjYWxsZWQuXG4gICAqIEJ5IHN1YmNsYXNzaW5nIHRoaXMgbWV0aG9kIHlvdSBjYW4gcGVyZm9ybSB0YXNrcyBsaWtlIGhhbHRpbmcgdGhlIHVwZGF0ZSB0aW1lcnMuXG4gICAqL1xuICAvLyBzdXNwZW5kKCk6IHZvaWQge1xuICAvLyAgIExvZy5sb2coYFske3RoaXMubmFtZX1dIHN1c3BlbmRgKTtcbiAgLy8gfSxcblxuICAvKipcbiAgICogV2hlbiBhIG1vZHVsZSBpcyByZXF1ZXN0ZWQgdG8gYmUgc2hvd24gKHVzaW5nIHRoZSBtb2R1bGUuc2hvdygpIG1ldGhvZCksIHRoZSByZXN1bWUoKSBtZXRob2Qgd2lsbCBiZSBjYWxsZWQuXG4gICAqIEJ5IHN1YmNsYXNzaW5nIHRoaXMgbWV0aG9kIHlvdSBjYW4gcGVyZm9ybSB0YXNrcyByZXN0YXJ0aW5nIHRoZSB1cGRhdGUgdGltZXJzLlxuICAgKi9cbiAgLy8gcmVzdW1lKCk6IHZvaWQge1xuICAvLyAgIExvZy5sb2coYFske3RoaXMubmFtZX1dIHJlc3VtZWApO1xuICAvLyB9LFxufSk7XG4iLCIvLyBDb3B5cmlnaHQgSm95ZW50LCBJbmMuIGFuZCBvdGhlciBOb2RlIGNvbnRyaWJ1dG9ycy5cbi8vXG4vLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYVxuLy8gY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZVxuLy8gXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nXG4vLyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsXG4vLyBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0XG4vLyBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGVcbi8vIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkXG4vLyBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbi8vXG4vLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTXG4vLyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GXG4vLyBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOXG4vLyBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSxcbi8vIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUlxuLy8gT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRVxuLy8gVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS5cblxuJ3VzZSBzdHJpY3QnO1xuXG52YXIgUiA9IHR5cGVvZiBSZWZsZWN0ID09PSAnb2JqZWN0JyA/IFJlZmxlY3QgOiBudWxsXG52YXIgUmVmbGVjdEFwcGx5ID0gUiAmJiB0eXBlb2YgUi5hcHBseSA9PT0gJ2Z1bmN0aW9uJ1xuICA/IFIuYXBwbHlcbiAgOiBmdW5jdGlvbiBSZWZsZWN0QXBwbHkodGFyZ2V0LCByZWNlaXZlciwgYXJncykge1xuICAgIHJldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuY2FsbCh0YXJnZXQsIHJlY2VpdmVyLCBhcmdzKTtcbiAgfVxuXG52YXIgUmVmbGVjdE93bktleXNcbmlmIChSICYmIHR5cGVvZiBSLm93bktleXMgPT09ICdmdW5jdGlvbicpIHtcbiAgUmVmbGVjdE93bktleXMgPSBSLm93bktleXNcbn0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykge1xuICBSZWZsZWN0T3duS2V5cyA9IGZ1bmN0aW9uIFJlZmxlY3RPd25LZXlzKHRhcmdldCkge1xuICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0YXJnZXQpXG4gICAgICAuY29uY2F0KE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHModGFyZ2V0KSk7XG4gIH07XG59IGVsc2Uge1xuICBSZWZsZWN0T3duS2V5cyA9IGZ1bmN0aW9uIFJlZmxlY3RPd25LZXlzKHRhcmdldCkge1xuICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0YXJnZXQpO1xuICB9O1xufVxuXG5mdW5jdGlvbiBQcm9jZXNzRW1pdFdhcm5pbmcod2FybmluZykge1xuICBpZiAoY29uc29sZSAmJiBjb25zb2xlLndhcm4pIGNvbnNvbGUud2Fybih3YXJuaW5nKTtcbn1cblxudmFyIE51bWJlcklzTmFOID0gTnVtYmVyLmlzTmFOIHx8IGZ1bmN0aW9uIE51bWJlcklzTmFOKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZSAhPT0gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIEV2ZW50RW1pdHRlcigpIHtcbiAgRXZlbnRFbWl0dGVyLmluaXQuY2FsbCh0aGlzKTtcbn1cbm1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyO1xuXG4vLyBCYWNrd2FyZHMtY29tcGF0IHdpdGggbm9kZSAwLjEwLnhcbkV2ZW50RW1pdHRlci5FdmVudEVtaXR0ZXIgPSBFdmVudEVtaXR0ZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX2V2ZW50cyA9IHVuZGVmaW5lZDtcbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX2V2ZW50c0NvdW50ID0gMDtcbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX21heExpc3RlbmVycyA9IHVuZGVmaW5lZDtcblxuLy8gQnkgZGVmYXVsdCBFdmVudEVtaXR0ZXJzIHdpbGwgcHJpbnQgYSB3YXJuaW5nIGlmIG1vcmUgdGhhbiAxMCBsaXN0ZW5lcnMgYXJlXG4vLyBhZGRlZCB0byBpdC4gVGhpcyBpcyBhIHVzZWZ1bCBkZWZhdWx0IHdoaWNoIGhlbHBzIGZpbmRpbmcgbWVtb3J5IGxlYWtzLlxudmFyIGRlZmF1bHRNYXhMaXN0ZW5lcnMgPSAxMDtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KEV2ZW50RW1pdHRlciwgJ2RlZmF1bHRNYXhMaXN0ZW5lcnMnLCB7XG4gIGVudW1lcmFibGU6IHRydWUsXG4gIGdldDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGRlZmF1bHRNYXhMaXN0ZW5lcnM7XG4gIH0sXG4gIHNldDogZnVuY3Rpb24oYXJnKSB7XG4gICAgaWYgKHR5cGVvZiBhcmcgIT09ICdudW1iZXInIHx8IGFyZyA8IDAgfHwgTnVtYmVySXNOYU4oYXJnKSkge1xuICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RoZSB2YWx1ZSBvZiBcImRlZmF1bHRNYXhMaXN0ZW5lcnNcIiBpcyBvdXQgb2YgcmFuZ2UuIEl0IG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyLiBSZWNlaXZlZCAnICsgYXJnICsgJy4nKTtcbiAgICB9XG4gICAgZGVmYXVsdE1heExpc3RlbmVycyA9IGFyZztcbiAgfVxufSk7XG5cbkV2ZW50RW1pdHRlci5pbml0ID0gZnVuY3Rpb24oKSB7XG5cbiAgaWYgKHRoaXMuX2V2ZW50cyA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICB0aGlzLl9ldmVudHMgPT09IE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKS5fZXZlbnRzKSB7XG4gICAgdGhpcy5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLl9ldmVudHNDb3VudCA9IDA7XG4gIH1cblxuICB0aGlzLl9tYXhMaXN0ZW5lcnMgPSB0aGlzLl9tYXhMaXN0ZW5lcnMgfHwgdW5kZWZpbmVkO1xufTtcblxuLy8gT2J2aW91c2x5IG5vdCBhbGwgRW1pdHRlcnMgc2hvdWxkIGJlIGxpbWl0ZWQgdG8gMTAuIFRoaXMgZnVuY3Rpb24gYWxsb3dzXG4vLyB0aGF0IHRvIGJlIGluY3JlYXNlZC4gU2V0IHRvIHplcm8gZm9yIHVubGltaXRlZC5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuc2V0TWF4TGlzdGVuZXJzID0gZnVuY3Rpb24gc2V0TWF4TGlzdGVuZXJzKG4pIHtcbiAgaWYgKHR5cGVvZiBuICE9PSAnbnVtYmVyJyB8fCBuIDwgMCB8fCBOdW1iZXJJc05hTihuKSkge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdUaGUgdmFsdWUgb2YgXCJuXCIgaXMgb3V0IG9mIHJhbmdlLiBJdCBtdXN0IGJlIGEgbm9uLW5lZ2F0aXZlIG51bWJlci4gUmVjZWl2ZWQgJyArIG4gKyAnLicpO1xuICB9XG4gIHRoaXMuX21heExpc3RlbmVycyA9IG47XG4gIHJldHVybiB0aGlzO1xufTtcblxuZnVuY3Rpb24gJGdldE1heExpc3RlbmVycyh0aGF0KSB7XG4gIGlmICh0aGF0Ll9tYXhMaXN0ZW5lcnMgPT09IHVuZGVmaW5lZClcbiAgICByZXR1cm4gRXZlbnRFbWl0dGVyLmRlZmF1bHRNYXhMaXN0ZW5lcnM7XG4gIHJldHVybiB0aGF0Ll9tYXhMaXN0ZW5lcnM7XG59XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuZ2V0TWF4TGlzdGVuZXJzID0gZnVuY3Rpb24gZ2V0TWF4TGlzdGVuZXJzKCkge1xuICByZXR1cm4gJGdldE1heExpc3RlbmVycyh0aGlzKTtcbn07XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuZW1pdCA9IGZ1bmN0aW9uIGVtaXQodHlwZSkge1xuICB2YXIgYXJncyA9IFtdO1xuICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgYXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7XG4gIHZhciBkb0Vycm9yID0gKHR5cGUgPT09ICdlcnJvcicpO1xuXG4gIHZhciBldmVudHMgPSB0aGlzLl9ldmVudHM7XG4gIGlmIChldmVudHMgIT09IHVuZGVmaW5lZClcbiAgICBkb0Vycm9yID0gKGRvRXJyb3IgJiYgZXZlbnRzLmVycm9yID09PSB1bmRlZmluZWQpO1xuICBlbHNlIGlmICghZG9FcnJvcilcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgLy8gSWYgdGhlcmUgaXMgbm8gJ2Vycm9yJyBldmVudCBsaXN0ZW5lciB0aGVuIHRocm93LlxuICBpZiAoZG9FcnJvcikge1xuICAgIHZhciBlcjtcbiAgICBpZiAoYXJncy5sZW5ndGggPiAwKVxuICAgICAgZXIgPSBhcmdzWzBdO1xuICAgIGlmIChlciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAvLyBOb3RlOiBUaGUgY29tbWVudHMgb24gdGhlIGB0aHJvd2AgbGluZXMgYXJlIGludGVudGlvbmFsLCB0aGV5IHNob3dcbiAgICAgIC8vIHVwIGluIE5vZGUncyBvdXRwdXQgaWYgdGhpcyByZXN1bHRzIGluIGFuIHVuaGFuZGxlZCBleGNlcHRpb24uXG4gICAgICB0aHJvdyBlcjsgLy8gVW5oYW5kbGVkICdlcnJvcicgZXZlbnRcbiAgICB9XG4gICAgLy8gQXQgbGVhc3QgZ2l2ZSBzb21lIGtpbmQgb2YgY29udGV4dCB0byB0aGUgdXNlclxuICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoJ1VuaGFuZGxlZCBlcnJvci4nICsgKGVyID8gJyAoJyArIGVyLm1lc3NhZ2UgKyAnKScgOiAnJykpO1xuICAgIGVyci5jb250ZXh0ID0gZXI7XG4gICAgdGhyb3cgZXJyOyAvLyBVbmhhbmRsZWQgJ2Vycm9yJyBldmVudFxuICB9XG5cbiAgdmFyIGhhbmRsZXIgPSBldmVudHNbdHlwZV07XG5cbiAgaWYgKGhhbmRsZXIgPT09IHVuZGVmaW5lZClcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgaWYgKHR5cGVvZiBoYW5kbGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgUmVmbGVjdEFwcGx5KGhhbmRsZXIsIHRoaXMsIGFyZ3MpO1xuICB9IGVsc2Uge1xuICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDtcbiAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICBSZWZsZWN0QXBwbHkobGlzdGVuZXJzW2ldLCB0aGlzLCBhcmdzKTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuZnVuY3Rpb24gX2FkZExpc3RlbmVyKHRhcmdldCwgdHlwZSwgbGlzdGVuZXIsIHByZXBlbmQpIHtcbiAgdmFyIG07XG4gIHZhciBldmVudHM7XG4gIHZhciBleGlzdGluZztcblxuICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlIFwibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgRnVuY3Rpb24uIFJlY2VpdmVkIHR5cGUgJyArIHR5cGVvZiBsaXN0ZW5lcik7XG4gIH1cblxuICBldmVudHMgPSB0YXJnZXQuX2V2ZW50cztcbiAgaWYgKGV2ZW50cyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgZXZlbnRzID0gdGFyZ2V0Ll9ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIHRhcmdldC5fZXZlbnRzQ291bnQgPSAwO1xuICB9IGVsc2Uge1xuICAgIC8vIFRvIGF2b2lkIHJlY3Vyc2lvbiBpbiB0aGUgY2FzZSB0aGF0IHR5cGUgPT09IFwibmV3TGlzdGVuZXJcIiEgQmVmb3JlXG4gICAgLy8gYWRkaW5nIGl0IHRvIHRoZSBsaXN0ZW5lcnMsIGZpcnN0IGVtaXQgXCJuZXdMaXN0ZW5lclwiLlxuICAgIGlmIChldmVudHMubmV3TGlzdGVuZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGFyZ2V0LmVtaXQoJ25ld0xpc3RlbmVyJywgdHlwZSxcbiAgICAgICAgICAgICAgICAgIGxpc3RlbmVyLmxpc3RlbmVyID8gbGlzdGVuZXIubGlzdGVuZXIgOiBsaXN0ZW5lcik7XG5cbiAgICAgIC8vIFJlLWFzc2lnbiBgZXZlbnRzYCBiZWNhdXNlIGEgbmV3TGlzdGVuZXIgaGFuZGxlciBjb3VsZCBoYXZlIGNhdXNlZCB0aGVcbiAgICAgIC8vIHRoaXMuX2V2ZW50cyB0byBiZSBhc3NpZ25lZCB0byBhIG5ldyBvYmplY3RcbiAgICAgIGV2ZW50cyA9IHRhcmdldC5fZXZlbnRzO1xuICAgIH1cbiAgICBleGlzdGluZyA9IGV2ZW50c1t0eXBlXTtcbiAgfVxuXG4gIGlmIChleGlzdGluZyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gT3B0aW1pemUgdGhlIGNhc2Ugb2Ygb25lIGxpc3RlbmVyLiBEb24ndCBuZWVkIHRoZSBleHRyYSBhcnJheSBvYmplY3QuXG4gICAgZXhpc3RpbmcgPSBldmVudHNbdHlwZV0gPSBsaXN0ZW5lcjtcbiAgICArK3RhcmdldC5fZXZlbnRzQ291bnQ7XG4gIH0gZWxzZSB7XG4gICAgaWYgKHR5cGVvZiBleGlzdGluZyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgLy8gQWRkaW5nIHRoZSBzZWNvbmQgZWxlbWVudCwgbmVlZCB0byBjaGFuZ2UgdG8gYXJyYXkuXG4gICAgICBleGlzdGluZyA9IGV2ZW50c1t0eXBlXSA9XG4gICAgICAgIHByZXBlbmQgPyBbbGlzdGVuZXIsIGV4aXN0aW5nXSA6IFtleGlzdGluZywgbGlzdGVuZXJdO1xuICAgICAgLy8gSWYgd2UndmUgYWxyZWFkeSBnb3QgYW4gYXJyYXksIGp1c3QgYXBwZW5kLlxuICAgIH0gZWxzZSBpZiAocHJlcGVuZCkge1xuICAgICAgZXhpc3RpbmcudW5zaGlmdChsaXN0ZW5lcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGV4aXN0aW5nLnB1c2gobGlzdGVuZXIpO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGZvciBsaXN0ZW5lciBsZWFrXG4gICAgbSA9ICRnZXRNYXhMaXN0ZW5lcnModGFyZ2V0KTtcbiAgICBpZiAobSA+IDAgJiYgZXhpc3RpbmcubGVuZ3RoID4gbSAmJiAhZXhpc3Rpbmcud2FybmVkKSB7XG4gICAgICBleGlzdGluZy53YXJuZWQgPSB0cnVlO1xuICAgICAgLy8gTm8gZXJyb3IgY29kZSBmb3IgdGhpcyBzaW5jZSBpdCBpcyBhIFdhcm5pbmdcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgdmFyIHcgPSBuZXcgRXJyb3IoJ1Bvc3NpYmxlIEV2ZW50RW1pdHRlciBtZW1vcnkgbGVhayBkZXRlY3RlZC4gJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nLmxlbmd0aCArICcgJyArIFN0cmluZyh0eXBlKSArICcgbGlzdGVuZXJzICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnYWRkZWQuIFVzZSBlbWl0dGVyLnNldE1heExpc3RlbmVycygpIHRvICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5jcmVhc2UgbGltaXQnKTtcbiAgICAgIHcubmFtZSA9ICdNYXhMaXN0ZW5lcnNFeGNlZWRlZFdhcm5pbmcnO1xuICAgICAgdy5lbWl0dGVyID0gdGFyZ2V0O1xuICAgICAgdy50eXBlID0gdHlwZTtcbiAgICAgIHcuY291bnQgPSBleGlzdGluZy5sZW5ndGg7XG4gICAgICBQcm9jZXNzRW1pdFdhcm5pbmcodyk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRhcmdldDtcbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5hZGRMaXN0ZW5lciA9IGZ1bmN0aW9uIGFkZExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7XG4gIHJldHVybiBfYWRkTGlzdGVuZXIodGhpcywgdHlwZSwgbGlzdGVuZXIsIGZhbHNlKTtcbn07XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUub24gPSBFdmVudEVtaXR0ZXIucHJvdG90eXBlLmFkZExpc3RlbmVyO1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnByZXBlbmRMaXN0ZW5lciA9XG4gICAgZnVuY3Rpb24gcHJlcGVuZExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICByZXR1cm4gX2FkZExpc3RlbmVyKHRoaXMsIHR5cGUsIGxpc3RlbmVyLCB0cnVlKTtcbiAgICB9O1xuXG5mdW5jdGlvbiBvbmNlV3JhcHBlcigpIHtcbiAgdmFyIGFyZ3MgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIGFyZ3MucHVzaChhcmd1bWVudHNbaV0pO1xuICBpZiAoIXRoaXMuZmlyZWQpIHtcbiAgICB0aGlzLnRhcmdldC5yZW1vdmVMaXN0ZW5lcih0aGlzLnR5cGUsIHRoaXMud3JhcEZuKTtcbiAgICB0aGlzLmZpcmVkID0gdHJ1ZTtcbiAgICBSZWZsZWN0QXBwbHkodGhpcy5saXN0ZW5lciwgdGhpcy50YXJnZXQsIGFyZ3MpO1xuICB9XG59XG5cbmZ1bmN0aW9uIF9vbmNlV3JhcCh0YXJnZXQsIHR5cGUsIGxpc3RlbmVyKSB7XG4gIHZhciBzdGF0ZSA9IHsgZmlyZWQ6IGZhbHNlLCB3cmFwRm46IHVuZGVmaW5lZCwgdGFyZ2V0OiB0YXJnZXQsIHR5cGU6IHR5cGUsIGxpc3RlbmVyOiBsaXN0ZW5lciB9O1xuICB2YXIgd3JhcHBlZCA9IG9uY2VXcmFwcGVyLmJpbmQoc3RhdGUpO1xuICB3cmFwcGVkLmxpc3RlbmVyID0gbGlzdGVuZXI7XG4gIHN0YXRlLndyYXBGbiA9IHdyYXBwZWQ7XG4gIHJldHVybiB3cmFwcGVkO1xufVxuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLm9uY2UgPSBmdW5jdGlvbiBvbmNlKHR5cGUsIGxpc3RlbmVyKSB7XG4gIGlmICh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgXCJsaXN0ZW5lclwiIGFyZ3VtZW50IG11c3QgYmUgb2YgdHlwZSBGdW5jdGlvbi4gUmVjZWl2ZWQgdHlwZSAnICsgdHlwZW9mIGxpc3RlbmVyKTtcbiAgfVxuICB0aGlzLm9uKHR5cGUsIF9vbmNlV3JhcCh0aGlzLCB0eXBlLCBsaXN0ZW5lcikpO1xuICByZXR1cm4gdGhpcztcbn07XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucHJlcGVuZE9uY2VMaXN0ZW5lciA9XG4gICAgZnVuY3Rpb24gcHJlcGVuZE9uY2VMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikge1xuICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgXCJsaXN0ZW5lclwiIGFyZ3VtZW50IG11c3QgYmUgb2YgdHlwZSBGdW5jdGlvbi4gUmVjZWl2ZWQgdHlwZSAnICsgdHlwZW9mIGxpc3RlbmVyKTtcbiAgICAgIH1cbiAgICAgIHRoaXMucHJlcGVuZExpc3RlbmVyKHR5cGUsIF9vbmNlV3JhcCh0aGlzLCB0eXBlLCBsaXN0ZW5lcikpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuLy8gRW1pdHMgYSAncmVtb3ZlTGlzdGVuZXInIGV2ZW50IGlmIGFuZCBvbmx5IGlmIHRoZSBsaXN0ZW5lciB3YXMgcmVtb3ZlZC5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPVxuICAgIGZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICB2YXIgbGlzdCwgZXZlbnRzLCBwb3NpdGlvbiwgaSwgb3JpZ2luYWxMaXN0ZW5lcjtcblxuICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgXCJsaXN0ZW5lclwiIGFyZ3VtZW50IG11c3QgYmUgb2YgdHlwZSBGdW5jdGlvbi4gUmVjZWl2ZWQgdHlwZSAnICsgdHlwZW9mIGxpc3RlbmVyKTtcbiAgICAgIH1cblxuICAgICAgZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuICAgICAgaWYgKGV2ZW50cyA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm4gdGhpcztcblxuICAgICAgbGlzdCA9IGV2ZW50c1t0eXBlXTtcbiAgICAgIGlmIChsaXN0ID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICBpZiAobGlzdCA9PT0gbGlzdGVuZXIgfHwgbGlzdC5saXN0ZW5lciA9PT0gbGlzdGVuZXIpIHtcbiAgICAgICAgaWYgKC0tdGhpcy5fZXZlbnRzQ291bnQgPT09IDApXG4gICAgICAgICAgdGhpcy5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgZGVsZXRlIGV2ZW50c1t0eXBlXTtcbiAgICAgICAgICBpZiAoZXZlbnRzLnJlbW92ZUxpc3RlbmVyKVxuICAgICAgICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIGxpc3QubGlzdGVuZXIgfHwgbGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBsaXN0ICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHBvc2l0aW9uID0gLTE7XG5cbiAgICAgICAgZm9yIChpID0gbGlzdC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIGlmIChsaXN0W2ldID09PSBsaXN0ZW5lciB8fCBsaXN0W2ldLmxpc3RlbmVyID09PSBsaXN0ZW5lcikge1xuICAgICAgICAgICAgb3JpZ2luYWxMaXN0ZW5lciA9IGxpc3RbaV0ubGlzdGVuZXI7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IGk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocG9zaXRpb24gPCAwKVxuICAgICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICAgIGlmIChwb3NpdGlvbiA9PT0gMClcbiAgICAgICAgICBsaXN0LnNoaWZ0KCk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHNwbGljZU9uZShsaXN0LCBwb3NpdGlvbik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobGlzdC5sZW5ndGggPT09IDEpXG4gICAgICAgICAgZXZlbnRzW3R5cGVdID0gbGlzdFswXTtcblxuICAgICAgICBpZiAoZXZlbnRzLnJlbW92ZUxpc3RlbmVyICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIG9yaWdpbmFsTGlzdGVuZXIgfHwgbGlzdGVuZXIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLm9mZiA9IEV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzID1cbiAgICBmdW5jdGlvbiByZW1vdmVBbGxMaXN0ZW5lcnModHlwZSkge1xuICAgICAgdmFyIGxpc3RlbmVycywgZXZlbnRzLCBpO1xuXG4gICAgICBldmVudHMgPSB0aGlzLl9ldmVudHM7XG4gICAgICBpZiAoZXZlbnRzID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICAvLyBub3QgbGlzdGVuaW5nIGZvciByZW1vdmVMaXN0ZW5lciwgbm8gbmVlZCB0byBlbWl0XG4gICAgICBpZiAoZXZlbnRzLnJlbW92ZUxpc3RlbmVyID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB0aGlzLl9ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgICAgICAgIHRoaXMuX2V2ZW50c0NvdW50ID0gMDtcbiAgICAgICAgfSBlbHNlIGlmIChldmVudHNbdHlwZV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGlmICgtLXRoaXMuX2V2ZW50c0NvdW50ID09PSAwKVxuICAgICAgICAgICAgdGhpcy5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICBkZWxldGUgZXZlbnRzW3R5cGVdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuXG4gICAgICAvLyBlbWl0IHJlbW92ZUxpc3RlbmVyIGZvciBhbGwgbGlzdGVuZXJzIG9uIGFsbCBldmVudHNcbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoZXZlbnRzKTtcbiAgICAgICAgdmFyIGtleTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICBrZXkgPSBrZXlzW2ldO1xuICAgICAgICAgIGlmIChrZXkgPT09ICdyZW1vdmVMaXN0ZW5lcicpIGNvbnRpbnVlO1xuICAgICAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ3JlbW92ZUxpc3RlbmVyJyk7XG4gICAgICAgIHRoaXMuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIHRoaXMuX2V2ZW50c0NvdW50ID0gMDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG5cbiAgICAgIGxpc3RlbmVycyA9IGV2ZW50c1t0eXBlXTtcblxuICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lcnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcnMpO1xuICAgICAgfSBlbHNlIGlmIChsaXN0ZW5lcnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAvLyBMSUZPIG9yZGVyXG4gICAgICAgIGZvciAoaSA9IGxpc3RlbmVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXJzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG5mdW5jdGlvbiBfbGlzdGVuZXJzKHRhcmdldCwgdHlwZSwgdW53cmFwKSB7XG4gIHZhciBldmVudHMgPSB0YXJnZXQuX2V2ZW50cztcblxuICBpZiAoZXZlbnRzID09PSB1bmRlZmluZWQpXG4gICAgcmV0dXJuIFtdO1xuXG4gIHZhciBldmxpc3RlbmVyID0gZXZlbnRzW3R5cGVdO1xuICBpZiAoZXZsaXN0ZW5lciA9PT0gdW5kZWZpbmVkKVxuICAgIHJldHVybiBbXTtcblxuICBpZiAodHlwZW9mIGV2bGlzdGVuZXIgPT09ICdmdW5jdGlvbicpXG4gICAgcmV0dXJuIHVud3JhcCA/IFtldmxpc3RlbmVyLmxpc3RlbmVyIHx8IGV2bGlzdGVuZXJdIDogW2V2bGlzdGVuZXJdO1xuXG4gIHJldHVybiB1bndyYXAgP1xuICAgIHVud3JhcExpc3RlbmVycyhldmxpc3RlbmVyKSA6IGFycmF5Q2xvbmUoZXZsaXN0ZW5lciwgZXZsaXN0ZW5lci5sZW5ndGgpO1xufVxuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmxpc3RlbmVycyA9IGZ1bmN0aW9uIGxpc3RlbmVycyh0eXBlKSB7XG4gIHJldHVybiBfbGlzdGVuZXJzKHRoaXMsIHR5cGUsIHRydWUpO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5yYXdMaXN0ZW5lcnMgPSBmdW5jdGlvbiByYXdMaXN0ZW5lcnModHlwZSkge1xuICByZXR1cm4gX2xpc3RlbmVycyh0aGlzLCB0eXBlLCBmYWxzZSk7XG59O1xuXG5FdmVudEVtaXR0ZXIubGlzdGVuZXJDb3VudCA9IGZ1bmN0aW9uKGVtaXR0ZXIsIHR5cGUpIHtcbiAgaWYgKHR5cGVvZiBlbWl0dGVyLmxpc3RlbmVyQ291bnQgPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gZW1pdHRlci5saXN0ZW5lckNvdW50KHR5cGUpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBsaXN0ZW5lckNvdW50LmNhbGwoZW1pdHRlciwgdHlwZSk7XG4gIH1cbn07XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUubGlzdGVuZXJDb3VudCA9IGxpc3RlbmVyQ291bnQ7XG5mdW5jdGlvbiBsaXN0ZW5lckNvdW50KHR5cGUpIHtcbiAgdmFyIGV2ZW50cyA9IHRoaXMuX2V2ZW50cztcblxuICBpZiAoZXZlbnRzICE9PSB1bmRlZmluZWQpIHtcbiAgICB2YXIgZXZsaXN0ZW5lciA9IGV2ZW50c1t0eXBlXTtcblxuICAgIGlmICh0eXBlb2YgZXZsaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfSBlbHNlIGlmIChldmxpc3RlbmVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBldmxpc3RlbmVyLmxlbmd0aDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gMDtcbn1cblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5ldmVudE5hbWVzID0gZnVuY3Rpb24gZXZlbnROYW1lcygpIHtcbiAgcmV0dXJuIHRoaXMuX2V2ZW50c0NvdW50ID4gMCA/IFJlZmxlY3RPd25LZXlzKHRoaXMuX2V2ZW50cykgOiBbXTtcbn07XG5cbmZ1bmN0aW9uIGFycmF5Q2xvbmUoYXJyLCBuKSB7XG4gIHZhciBjb3B5ID0gbmV3IEFycmF5KG4pO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IG47ICsraSlcbiAgICBjb3B5W2ldID0gYXJyW2ldO1xuICByZXR1cm4gY29weTtcbn1cblxuZnVuY3Rpb24gc3BsaWNlT25lKGxpc3QsIGluZGV4KSB7XG4gIGZvciAoOyBpbmRleCArIDEgPCBsaXN0Lmxlbmd0aDsgaW5kZXgrKylcbiAgICBsaXN0W2luZGV4XSA9IGxpc3RbaW5kZXggKyAxXTtcbiAgbGlzdC5wb3AoKTtcbn1cblxuZnVuY3Rpb24gdW53cmFwTGlzdGVuZXJzKGFycikge1xuICB2YXIgcmV0ID0gbmV3IEFycmF5KGFyci5sZW5ndGgpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHJldC5sZW5ndGg7ICsraSkge1xuICAgIHJldFtpXSA9IGFycltpXS5saXN0ZW5lciB8fCBhcnJbaV07XG4gIH1cbiAgcmV0dXJuIHJldDtcbn1cbiIsImltcG9ydCB7IElNYWdpY01pcnJvckhlbHBlciwgSU1NTG9nLCBJQ2xpZW50TW9kdWxlSW5zdGFuY2VQcm9wZXJ0aWVzLCBJU2lnbmFnZVRpbWVsaW5lTW9kdWxlIH0gZnJvbSAnLi4vaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBTb2NrZXRTZXJ2aWNlIH0gZnJvbSAnLi9zb2NrZXQuc2VydmljZSc7XG5cbmV4cG9ydCBjbGFzcyBNb2R1bGVzU2VydmljZSB7XG5cbiAgcHVibGljIHN0YXRpYyBpbnN0YW5jZT86IE1vZHVsZXNTZXJ2aWNlO1xuXG4gIHByb3RlY3RlZCBzb2NrZXRTZXJ2aWNlOiBTb2NrZXRTZXJ2aWNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCByZWFkb25seSBtYWdpY01pcnJvckhlbHBlcjogSU1hZ2ljTWlycm9ySGVscGVyLFxuICAgIHByb3RlY3RlZCByZWFkb25seSBtYWdpY01pcnJvckxvZ2dlcjogSU1NTG9nLFxuICAgIHByb3RlY3RlZCByZWFkb25seSBtYWdpY01pcnJvck1vZHVsZTogSUNsaWVudE1vZHVsZUluc3RhbmNlUHJvcGVydGllcyxcbiAgKSB7XG4gICAgdGhpcy5zb2NrZXRTZXJ2aWNlID0gbmV3IFNvY2tldFNlcnZpY2UobWFnaWNNaXJyb3JIZWxwZXIsIG1hZ2ljTWlycm9yTG9nZ2VyLCBtYWdpY01pcnJvck1vZHVsZSk7XG4gICAgaWYgKE1vZHVsZXNTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICByZXR1cm4gTW9kdWxlc1NlcnZpY2UuaW5zdGFuY2U7XG4gICAgfVxuICAgIE1vZHVsZXNTZXJ2aWNlLmluc3RhbmNlID0gdGhpcztcblxuICAgIHRoaXMuc29ja2V0U2VydmljZS5vbignU0hPV19NT0RVTEVTJywgKHBheWxvYWQpID0+IHtcbiAgICAgIHRoaXMubWFnaWNNaXJyb3JMb2dnZXIubG9nKCdNb2R1bGVzU2VydmljZScsIHBheWxvYWQpO1xuICAgICAgdGhpcy5oaWRlQWxsKCk7XG4gICAgICB0aGlzLnNldFBvc2l0aW9ucyhwYXlsb2FkLm1vZHVsZXMpO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0aWQobW5hbWU6IHN0cmluZykge1xuICAgIGxldCBpZDogc3RyaW5nO1xuICAgIHRoaXMubWFnaWNNaXJyb3JIZWxwZXIuZ2V0TW9kdWxlcygpLmVudW1lcmF0ZSgobW9kdWxlKSA9PiB7XG4gICAgICBpZiAobW5hbWUgPT09IG1vZHVsZS5uYW1lKSB7XG4gICAgICAgIGlkID0gbW9kdWxlLmlkZW50aWZpZXI7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGlkO1xuICB9XG5cbiAgaGlkZUFsbCgpIHtcbiAgICB0aGlzLm1hZ2ljTWlycm9ySGVscGVyLmdldE1vZHVsZXMoKS5lbnVtZXJhdGUoKG1vZHVsZSkgPT4ge1xuICAgICAgbW9kdWxlLmhpZGUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHNldFBvc2l0aW9ucyh0aW1lbGluZU1vZHVsZXM6IElTaWduYWdlVGltZWxpbmVNb2R1bGVbXSkge1xuICAgIHRoaXMubWFnaWNNaXJyb3JMb2dnZXIubG9nKCdzZXRQb3NpdGlvbnMnLCB0aW1lbGluZU1vZHVsZXMpO1xuICAgIGZvciAoY29uc3QgdGltZWxpbmVNb2R1bGUgb2YgdGltZWxpbmVNb2R1bGVzKSB7XG4gICAgICBjb25zdCBtb2R1bGVOYW1lID0gdGltZWxpbmVNb2R1bGUubW9kdWxlLm1vZHVsZTtcbiAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRpZChtb2R1bGVOYW1lKTtcbiAgICAgIHRoaXMubWFnaWNNaXJyb3JMb2dnZXIubG9nKCdpZCcsIGlkKTtcbiAgICAgIHRoaXMubWFnaWNNaXJyb3JIZWxwZXIuZ2V0TW9kdWxlcygpLndpdGhDbGFzcyhtb2R1bGVOYW1lKS5lbnVtZXJhdGUoKG1vZHVsZSkgPT4ge1xuICAgICAgICBpZiAodGltZWxpbmVNb2R1bGUucG9zaXRpb24pIHtcbiAgICAgICAgICBjb25zdCBzcGxpdFBvc2l0aW9uID0gdGltZWxpbmVNb2R1bGUucG9zaXRpb24uc3BsaXQoJ18nKTtcbiAgICAgICAgICBjb25zdCBzZWxlY3RlZE1vZHVsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcbiAgICAgICAgICBjb25zdCByZWdpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXYucmVnaW9uLicgKyBzcGxpdFBvc2l0aW9uWzBdICsgJy4nICsgc3BsaXRQb3NpdGlvblsxXSArICcgZGl2LmNvbnRhaW5lcicpIGFzIEhUTUxFbGVtZW50O1xuXG4gICAgICAgICAgdGhpcy5tYWdpY01pcnJvckxvZ2dlci5sb2coJ3NldFBvc2l0aW9ucycsIHRpbWVsaW5lTW9kdWxlLm5hbWUpO1xuXG4gICAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSByZWdpb24gaXMgdmlzaWJsZVxuICAgICAgICAgIGlmIChyZWdpb24uc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnKSB7XG4gICAgICAgICAgICByZWdpb24uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gTW92ZSBtb2R1bGVcbiAgICAgICAgICByZWdpb24uYXBwZW5kQ2hpbGQoc2VsZWN0ZWRNb2R1bGUpO1xuXG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgdGhlIG1vZHVsZSB2aXNpYmxlIGFmdGVyIG1vdmluZyB0byB0cmlnZ2VyIGNzcyBvcGFjaXR5IHRyYW5zaXRpb24gYW5pbWF0aW9uXG4gICAgICAgIGlmICh0aW1lbGluZU1vZHVsZS52aXNpYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgbW9kdWxlLnNob3coKTtcbiAgICAgICAgICAvLyBtb2R1bGUuc2hvdygxMDAwLCAoKSA9PiB7XG4gICAgICAgICAgLy8gICAvL1xuICAgICAgICAgIC8vIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKHRpbWVsaW5lTW9kdWxlLnZpc2libGUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgbW9kdWxlLmhpZGUoKTtcbiAgICAgICAgICAvLyBtb2R1bGUuaGlkZSgxMDAwLCAoKSA9PiB7XG4gICAgICAgICAgLy8gICAvL1xuICAgICAgICAgIC8vIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBzZXREZWZhdWx0cygpIHtcbiAgICB0aGlzLm1hZ2ljTWlycm9ySGVscGVyLmdldE1vZHVsZXMoKS5lbnVtZXJhdGUoKG1vZHVsZSkgPT4ge1xuICAgICAgaWYgKG1vZHVsZS5kYXRhLnBvc2l0aW9uKSB7XG4gICAgICAgIGNvbnN0IHNwbGl0UG9zaXRpb24gPSBtb2R1bGUuZGF0YS5wb3NpdGlvbi5zcGxpdCgnXycpO1xuICAgICAgICBjb25zdCBzZWxlY3RlZE1vZHVsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZS5pZGVudGlmaWVyKTtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2LnJlZ2lvbi4nICsgc3BsaXRQb3NpdGlvblswXSArICcuJyArIHNwbGl0UG9zaXRpb25bMV0gKyAnIGRpdi5jb250YWluZXInKSBhcyBIVE1MRWxlbWVudDtcblxuICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIHJlZ2lvbiBpcyB2aXNpYmxlXG4gICAgICAgIGlmIChyZWdpb24uc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnKSB7XG4gICAgICAgICAgcmVnaW9uLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTW92ZSBtb2R1bGUgdG8gaXRzIG9yaWdpbmFsIHBvc2l0aW9uXG4gICAgICAgIHJlZ2lvbi5hcHBlbmRDaGlsZChzZWxlY3RlZE1vZHVsZSk7XG5cbiAgICAgICAgLy8gU2hvdyBtb2R1bGVcbiAgICAgICAgbW9kdWxlLnNob3coMTAwMCwgKCkgPT4ge1xuICAgICAgICAgIC8vXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=